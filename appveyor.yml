os: Visual Studio 2015

environment:
  matrix:
   - COMPILER: msys64
     MINGW_ARCH: x86_64
     MINGW_ROOT: C:\msys64\mingw64
#     CMAKE_GENERATOR: 'MSYS Makefiles'

install:
  # Use cygwin to checkout source code, due to characters in sub-repo that mingw git can't handle
  - set OLD_PATH=%PATH%
  - set PATH=%PATH%;C:\cygwin\bin
  - C:\cygwin\bin\git submodule update --init --recursive
  - set PATH=%OLD_PATH%
  - if defined MINGW_ROOT set PATH=%MINGW_ROOT%\bin;C:\msys64\usr\bin\;%PATH%
  - if defined MINGW_ARCH bash -lc "pacman --noconfirm -S make gmp gmp-devel gcc git cmake"

before_build:
  - cmake -E make_directory build
  - cmake -E chdir build cmake -DCMAKE_BUILD_TYPE=Debug ..

build_script:
  - cmake --build build

test_script:
  - set CTEST_OUTPUT_ON_FAILURE=ON
  - cmake --build build --target test
